<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RLC Bingo Manager - Complete Mobile-Responsive System</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary: #667eea;
            --secondary: #764ba2;
            --success: #4caf50;
            --warning: #ff9800;
            --danger: #f44336;
            --info: #2196f3;
            --dark: #333;
            --light: #f5f5f5;
            --border: #e0e0e0;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            min-height: 100vh;
            padding: 10px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        /* Mobile-First Design */
        @media (max-width: 768px) {
            body {
                padding: 5px;
            }
            
            .header {
                padding: 15px !important;
            }
            
            .logo {
                font-size: 18px !important;
            }
            
            .nav-tabs {
                flex-direction: column;
                padding: 5px !important;
            }
            
            .nav-tab {
                width: 100%;
                justify-content: center;
                padding: 15px !important;
            }
            
            .form-grid {
                grid-template-columns: 1fr !important;
            }
            
            .stats-grid {
                grid-template-columns: 1fr 1fr !important;
            }
            
            .game-prize-grid {
                grid-template-columns: 1fr !important;
            }
        }
        
        /* Header */
        .header {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 24px;
            font-weight: 700;
            color: var(--dark);
        }
        
        .session-info {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .session-badge {
            padding: 8px 12px;
            background: #e3f2fd;
            border-radius: 8px;
            font-size: 12px;
            color: #1976d2;
        }
        
        /* Navigation */
        .nav-tabs {
            background: white;
            border-radius: 12px;
            padding: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
        }
        
        .nav-tab {
            padding: 12px 20px;
            background: transparent;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            color: #666;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            white-space: nowrap;
        }
        
        .nav-tab:hover {
            background: var(--light);
        }
        
        .nav-tab.active {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
        }
        
        /* Content */
        .content-section {
            display: none;
            animation: fadeIn 0.5s;
        }
        
        .content-section.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Forms */
        .form-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .form-header {
            font-size: 18px;
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--border);
        }
        
        .form-section-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--dark);
            margin: 20px 0 15px 0;
            padding: 10px;
            background: var(--light);
            border-radius: 8px;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        .form-label {
            font-size: 13px;
            color: #666;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        .form-input, .form-select, .form-textarea {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
            width: 100%;
        }
        
        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--primary);
        }
        
        .form-input[readonly] {
            background: var(--light);
            cursor: not-allowed;
        }
        
        /* Progressive Games Section */
        .progressive-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .progressive-card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 15px;
            border: 2px solid var(--border);
        }
        
        .progressive-title {
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 15px;
            font-size: 16px;
            text-align: center;
        }
        
        /* Special Games Grid */
        .special-games-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .special-game-card {
            background: white;
            border: 2px solid var(--primary);
            border-radius: 12px;
            padding: 15px;
        }
        
        .special-game-title {
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 10px;
            text-align: center;
            font-size: 16px;
        }
        
        /* Pull Tab Entry Section */
        .pull-tab-entry {
            background: #e8f5e9;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }
        
        /* Cash Summary Cards */
        .cash-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .cash-card {
            background: white;
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .cash-label {
            font-size: 12px;
            color: #666;
            margin-bottom: 8px;
        }
        
        .cash-amount {
            font-size: 24px;
            font-weight: 700;
        }
        
        .amount-positive { color: var(--success); }
        .amount-negative { color: var(--danger); }
        .amount-neutral { color: var(--dark); }
        
        /* Buttons */
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            white-space: nowrap;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
        }
        
        .btn-success { background: var(--success); color: white; }
        .btn-warning { background: var(--warning); color: white; }
        .btn-danger { background: var(--danger); color: white; }
        .btn-info { background: var(--info); color: white; }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        
        .btn-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 20px;
        }
        
        /* Status Indicators */
        .status-indicator {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .status-active { background: #c8e6c9; color: #2e7d32; }
        .status-complete { background: #bbdefb; color: #1565c0; }
        .status-pending { background: #fff9c4; color: #f57f17; }
        
        /* Toast Notifications */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            pointer-events: none;
        }
        
        .toast {
            background: white;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            display: flex;
            align-items: center;
            gap: 12px;
            animation: slideIn 0.3s;
            pointer-events: auto;
            max-width: 350px;
        }
        
        @keyframes slideIn {
            from { transform: translateX(400px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .toast-success { border-left: 4px solid var(--success); }
        .toast-error { border-left: 4px solid var(--danger); }
        .toast-warning { border-left: 4px solid var(--warning); }
        .toast-info { border-left: 4px solid var(--info); }
        
        /* Loading Overlay */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9998;
        }
        
        .loading-content {
            background: white;
            border-radius: 12px;
            padding: 30px;
            text-align: center;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid var(--light);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Responsive Tables */
        .table-responsive {
            overflow-x: auto;
            margin: 20px 0;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
        }
        
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }
        
        th {
            background: var(--light);
            font-weight: 600;
            color: var(--dark);
        }
        
        tr:hover {
            background: #fafafa;
        }
        
        /* Print Styles */
        @media print {
            body {
                background: white;
                padding: 0;
            }
            
            .nav-tabs, .btn, .header {
                display: none !important;
            }
            
            .form-card {
                box-shadow: none;
                border: 1px solid #000;
                break-inside: avoid;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="header-content">
                <div class="logo">
                    <span style="font-size: 32px;">ü¶Å</span>
                    <span>RLC Bingo Manager</span>
                </div>
                <div class="session-info">
                    <div class="session-badge" id="currentDate"></div>
                    <div class="session-badge" id="currentSession">No Active Session</div>
                    <div class="session-badge" id="currentUser">Guest</div>
                </div>
            </div>
        </div>
        
        <!-- Navigation -->
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab('dashboard')">
                <i class="material-icons">dashboard</i> Dashboard
            </button>
            <button class="nav-tab" onclick="switchTab('bingoOccasion')">
                <i class="material-icons">event</i> Bingo Occasion
            </button>
            <button class="nav-tab" onclick="switchTab('pullTabs')">
                <i class="material-icons">confirmation_number</i> Pull-Tabs
            </button>
            <button class="nav-tab" onclick="switchTab('cashClose')">
                <i class="material-icons">account_balance_wallet</i> Cash Close
            </button>
            <button class="nav-tab" onclick="switchTab('reports')">
                <i class="material-icons">assessment</i> Reports
            </button>
        </div>
        
        <!-- Dashboard Section -->
        <div class="content-section active" id="dashboardSection">
            <div class="cash-summary">
                <div class="cash-card">
                    <div class="cash-label">Today's Sessions</div>
                    <div class="cash-amount amount-neutral" id="sessionsCount">0</div>
                </div>
                <div class="cash-card">
                    <div class="cash-label">Total Players</div>
                    <div class="cash-amount amount-neutral" id="playersCount">0</div>
                </div>
                <div class="cash-card">
                    <div class="cash-label">Gross Receipts</div>
                    <div class="cash-amount amount-positive" id="grossReceipts">$0.00</div>
                </div>
                <div class="cash-card">
                    <div class="cash-label">Net Profit</div>
                    <div class="cash-amount amount-positive" id="netProfit">$0.00</div>
                </div>
            </div>
            
            <div class="form-card">
                <div class="form-header">Quick Actions</div>
                <div class="btn-group">
                    <button class="btn btn-primary" onclick="startNewOccasion()">
                        <i class="material-icons">add_circle</i> New Occasion
                    </button>
                    <button class="btn btn-success" onclick="switchTab('bingoOccasion')">
                        <i class="material-icons">point_of_sale</i> Door Sales
                    </button>
                    <button class="btn btn-warning" onclick="switchTab('pullTabs')">
                        <i class="material-icons">local_activity</i> Pull-Tabs
                    </button>
                    <button class="btn btn-info" onclick="loadRecentActivity()">
                        <i class="material-icons">refresh</i> Refresh
                    </button>
                </div>
            </div>
            
            <div class="form-card">
                <div class="form-header">Recent Activity</div>
                <div class="table-responsive">
                    <table id="activityTable">
                        <thead>
                            <tr>
                                <th>Date/Time</th>
                                <th>Session</th>
                                <th>Type</th>
                                <th>Amount</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="activityBody">
                            <tr>
                                <td colspan="5" style="text-align: center;">Loading...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- Bingo Occasion Section -->
        <div class="content-section" id="bingoOccasionSection">
            <div class="form-card">
                <div class="form-header">Bingo Occasion Report</div>
                
                <!-- Session Information -->
                <div class="form-section-title">Session Information</div>
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Date of Occasion</label>
                        <input type="date" class="form-input" id="occasionDate" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Day of Week</label>
                        <select class="form-select" id="dayOfWeek">
                            <option value="">Select Day</option>
                            <option value="Sunday">Sunday</option>
                            <option value="Monday">Monday</option>
                            <option value="Tuesday">Tuesday</option>
                            <option value="Wednesday">Wednesday</option>
                            <option value="Thursday">Thursday</option>
                            <option value="Friday">Friday</option>
                            <option value="Saturday">Saturday</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Session Number</label>
                        <select class="form-select" id="sessionNum">
                            <option value="1">Session 1 (Morning)</option>
                            <option value="2">Session 2 (Afternoon)</option>
                            <option value="3">Session 3 (Evening)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Closet Worker Name</label>
                        <input type="text" class="form-input" id="closetWorker" placeholder="Enter full name" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Lion in Charge (Pull-Tabs)</label>
                        <input type="text" class="form-input" id="lionInCharge" placeholder="Enter full name">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Total Players</label>
                        <input type="number" class="form-input" id="totalPlayers" placeholder="0" min="0">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Starting Cash</label>
                        <input type="number" class="form-input" id="startingCash" placeholder="0.00" step="0.01">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Number of Bingo Games</label>
                        <input type="number" class="form-input" id="bingoGamesCount" placeholder="0" min="0">
                    </div>
                </div>
                
                <!-- Progressive Games Information -->
                <div class="form-section-title">Progressive Games Information</div>
                <div class="progressive-container">
                    <div class="progressive-card">
                        <div class="progressive-title">First Progressive</div>
                        <div class="form-group">
                            <label class="form-label">Progressive Jackpot Offered</label>
                            <input type="number" class="form-input" id="prog1Jackpot" placeholder="0.00" step="0.01">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Number of Balls to Win</label>
                            <input type="number" class="form-input" id="prog1BallsToWin" placeholder="48" min="1" max="75">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Consolation Prize Offered</label>
                            <input type="number" class="form-input" id="prog1Consolation" placeholder="100.00" step="0.01">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Actual Prize Awarded</label>
                            <input type="number" class="form-input" id="prog1ActualPrize" placeholder="0.00" step="0.01">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Actual Balls Called</label>
                            <input type="number" class="form-input" id="prog1ActualBalls" placeholder="0" min="0" max="75">
                        </div>
                    </div>
                    
                    <div class="progressive-card">
                        <div class="progressive-title">Second Progressive</div>
                        <div class="form-group">
                            <label class="form-label">Progressive Jackpot Offered</label>
                            <input type="number" class="form-input" id="prog2Jackpot" placeholder="0.00" step="0.01">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Number of Balls to Win</label>
                            <input type="number" class="form-input" id="prog2BallsToWin" placeholder="47" min="1" max="75">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Consolation Prize Offered</label>
                            <input type="number" class="form-input" id="prog2Consolation" placeholder="100.00" step="0.01">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Actual Prize Awarded</label>
                            <input type="number" class="form-input" id="prog2ActualPrize" placeholder="0.00" step="0.01">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Actual Balls Called</label>
                            <input type="number" class="form-input" id="prog2ActualBalls" placeholder="0" min="0" max="75">
                        </div>
                    </div>
                </div>
                
                <!-- Special Games ($250 Letter X, $250 Number 7, $500 Coverall) -->
                <div class="form-section-title">Special Games</div>
                <div class="special-games-grid">
                    <div class="special-game-card">
                        <div class="special-game-title">$250 Letter X</div>
                        <div class="form-group">
                            <label class="form-label">Prize Amount</label>
                            <input type="number" class="form-input" value="250.00" readonly>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Actual Prize Paid</label>
                            <input type="number" class="form-input" id="letterXPrize" placeholder="250.00" step="0.01">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Balls Called</label>
                            <input type="number" class="form-input" id="letterXBalls" placeholder="0" min="0" max="75">
                        </div>
                    </div>
                    
                    <div class="special-game-card">
                        <div class="special-game-title">$250 Number 7</div>
                        <div class="form-group">
                            <label class="form-label">Prize Amount</label>
                            <input type="number" class="form-input" value="250.00" readonly>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Actual Prize Paid</label>
                            <input type="number" class="form-input" id="number7Prize" placeholder="250.00" step="0.01">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Balls Called</label>
                            <input type="number" class="form-input" id="number7Balls" placeholder="0" min="0" max="75">
                        </div>
                    </div>
                    
                    <div class="special-game-card">
                        <div class="special-game-title">$500 Coverall</div>
                        <div class="form-group">
                            <label class="form-label">Prize Amount</label>
                            <input type="number" class="form-input" value="500.00" readonly>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Actual Prize Paid</label>
                            <input type="number" class="form-input" id="coverallPrize" placeholder="500.00" step="0.01">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Balls Called</label>
                            <input type="number" class="form-input" id="coverallBalls" placeholder="0" min="0" max="75">
                        </div>
                    </div>
                </div>
                
                <!-- Door Sales Entry (e-BOS Data) -->
                <div class="form-section-title">Door Sales Summary (from e-BOS)</div>
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">6 Face (6 Packs) - Net Sold</label>
                        <input type="number" class="form-input" id="sixFaceNet" placeholder="0" onchange="calcSale(this, 10, 'sixFaceSales')">
                    </div>
                    <div class="form-group">
                        <label class="form-label">6 Face - Sales ($)</label>
                        <input type="number" class="form-input" id="sixFaceSales" placeholder="0.00" readonly>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">9 Face Solid - Net Sold</label>
                        <input type="number" class="form-input" id="nineSolidNet" placeholder="0" onchange="calcSale(this, 15, 'nineSolidSales')">
                    </div>
                    <div class="form-group">
                        <label class="form-label">9 Face Solid - Sales ($)</label>
                        <input type="number" class="form-input" id="nineSolidSales" placeholder="0.00" readonly>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">9 Face Stripe - Net Sold</label>
                        <input type="number" class="form-input" id="nineStripeNet" placeholder="0" onchange="calcSale(this, 10, 'nineStripeSales')">
                    </div>
                    <div class="form-group">
                        <label class="form-label">9 Face Stripe - Sales ($)</label>
                        <input type="number" class="form-input" id="nineStripeSales" placeholder="0.00" readonly>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Birthday Pack (BOGO) - Count</label>
                        <input type="number" class="form-input" id="birthdayBOGO" placeholder="0">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Birthday Sales ($)</label>
                        <input type="number" class="form-input" value="0.00" readonly>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Coverall Extra - Net Sold</label>
                        <input type="number" class="form-input" id="coverallExtraNet" placeholder="0" onchange="calcSale(this, 1, 'coverallExtraSales')">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Coverall Extra - Sales ($)</label>
                        <input type="number" class="form-input" id="coverallExtraSales" placeholder="0.00" readonly>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Early Bird Double - Net Sold</label>
                        <input type="number" class="form-input" id="earlyBirdNet" placeholder="0" onchange="calcSale(this, 5, 'earlyBirdSales')">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Early Bird - Sales ($)</label>
                        <input type="number" class="form-input" id="earlyBirdSales" placeholder="0.00" readonly>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Letter X Extra - Net Sold</label>
                        <input type="number" class="form-input" id="letterXNet" placeholder="0" onchange="calcSale(this, 1, 'letterXSales')">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Letter X - Sales ($)</label>
                        <input type="number" class="form-input" id="letterXSales" placeholder="0.00" readonly>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Number 7 Extra - Net Sold</label>
                        <input type="number" class="form-input" id="number7Net" placeholder="0" onchange="calcSale(this, 1, 'number7Sales')">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Number 7 - Sales ($)</label>
                        <input type="number" class="form-input" id="number7Sales" placeholder="0.00" readonly>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Progressive 18 Face ($5) - Net</label>
                        <input type="number" class="form-input" id="prog18Net" placeholder="0" onchange="calcSale(this, 5, 'prog18Sales')">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Prog 18 - Sales ($)</label>
                        <input type="number" class="form-input" id="prog18Sales" placeholder="0.00" readonly>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Progressive 3 Face ($1) - Net</label>
                        <input type="number" class="form-input" id="prog3Net" placeholder="0" onchange="calcSale(this, 1, 'prog3Sales')">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Prog 3 - Sales ($)</label>
                        <input type="number" class="form-input" id="prog3Sales" placeholder="0.00" readonly>
                    </div>
                </div>
                
                <!-- Electronic & Miscellaneous -->
                <div class="form-section-title">Electronic & Miscellaneous Sales</div>
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Electronic Bingo Total</label>
                        <input type="number" class="form-input" id="electronicTotal" placeholder="0.00" step="0.01" onchange="updateTotals()">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Daubers Sold</label>
                        <input type="number" class="form-input" id="dauberCount" placeholder="0" onchange="calcSale(this, 2, 'dauberSales')">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Dauber Sales ($)</label>
                        <input type="number" class="form-input" id="dauberSales" placeholder="0.00" readonly>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Other Misc Sales</label>
                        <input type="number" class="form-input" id="miscSales" placeholder="0.00" step="0.01" onchange="updateTotals()">
                    </div>
                </div>
                
                <!-- Other Prize Information -->
                <div class="form-section-title">Other Bingo Prizes</div>
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Regular Games Total Prizes</label>
                        <input type="number" class="form-input" id="regularPrizes" placeholder="0.00" step="0.01" onchange="updateBingoPrizes()">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Early Bird Total Prizes</label>
                        <input type="number" class="form-input" id="earlyBirdPrizes" placeholder="0.00" step="0.01" onchange="updateBingoPrizes()">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Total Bingo Prizes Awarded</label>
                        <input type="number" class="form-input" id="totalBingoPrizes" placeholder="0.00" readonly>
                    </div>
                </div>
                
                <!-- Summary -->
                <div class="cash-summary">
                    <div class="cash-card">
                        <div class="cash-label">Paper Sales</div>
                        <div class="cash-amount amount-neutral" id="paperTotal">$0.00</div>
                    </div>
                    <div class="cash-card">
                        <div class="cash-label">Electronic</div>
                        <div class="cash-amount amount-neutral" id="electronicDisplay">$0.00</div>
                    </div>
                    <div class="cash-card">
                        <div class="cash-label">Miscellaneous</div>
                        <div class="cash-amount amount-neutral" id="miscDisplay">$0.00</div>
                    </div>
                    <div class="cash-card">
                        <div class="cash-label">Bingo Gross</div>
                        <div class="cash-amount amount-positive" id="bingoGross">$0.00</div>
                    </div>
                </div>
                
                <div class="btn-group">
                    <button class="btn btn-primary" onclick="saveBingoOccasion()">
                        <i class="material-icons">save</i> Save Occasion Data
                    </button>
                    <button class="btn btn-info" onclick="clearBingoForm()">
                        <i class="material-icons">clear</i> Clear Form
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Pull-Tabs Section -->
        <div class="content-section" id="pullTabsSection">
            <div class="form-card">
                <div class="form-header">Pull-Tab Sales Entry</div>
                
                <div class="pull-tab-entry">
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Select Game</label>
                            <select class="form-select" id="ptGameSelect" onchange="loadPTGame()">
                                <option value="">Choose a game...</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Serial Number</label>
                            <input type="text" class="form-input" id="ptSerial" placeholder="Enter serial #">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Starting Tickets</label>
                            <input type="number" class="form-input" id="ptStarting" placeholder="0" onchange="calcPT()">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ending Tickets</label>
                            <input type="number" class="form-input" id="ptEnding" placeholder="0" onchange="calcPT()">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Tickets Sold</label>
                            <input type="number" class="form-input" id="ptSold" placeholder="0" readonly>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Price Per Ticket</label>
                            <input type="number" class="form-input" id="ptPrice" value="1.00" readonly>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Gross Sales</label>
                            <input type="number" class="form-input" id="ptGross" placeholder="0.00" readonly>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Prizes Paid</label>
                            <input type="number" class="form-input" id="ptPrizes" placeholder="0.00" onchange="calcPT()">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Net Profit</label>
                            <input type="number" class="form-input" id="ptNet" placeholder="0.00" readonly>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ideal Profit</label>
                            <input type="number" class="form-input" id="ptIdeal" placeholder="0.00" readonly>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Cash Turned In</label>
                            <input type="number" class="form-input" id="ptCashIn" placeholder="0.00" onchange="calcPTVariance()">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Cash Variance</label>
                            <input type="number" class="form-input" id="ptVariance" placeholder="0.00" readonly>
                        </div>
                    </div>
                    
                    <div class="btn-group">
                        <button class="btn btn-success" onclick="addPullTab()">
                            <i class="material-icons">add</i> Add Game
                        </button>
                        <button class="btn btn-warning" onclick="clearPTForm()">
                            <i class="material-icons">clear</i> Clear
                        </button>
                    </div>
                </div>
                
                <!-- Pull-Tab Summary -->
                <div class="form-section-title">Today's Pull-Tab Activity</div>
                <div class="table-responsive">
                    <table>
                        <thead>
                            <tr>
                                <th>Game</th>
                                <th>Serial</th>
                                <th>Sold</th>
                                <th>Gross</th>
                                <th>Prizes</th>
                                <th>Net</th>
                                <th>Cash In</th>
                                <th>Variance</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="ptTableBody">
                            <tr>
                                <td colspan="9" style="text-align: center;">No pull-tabs recorded yet</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <!-- Pull-Tab Totals -->
                <div class="cash-summary">
                    <div class="cash-card">
                        <div class="cash-label">Total Gross</div>
                        <div class="cash-amount amount-neutral" id="ptTotalGross">$0.00</div>
                    </div>
                    <div class="cash-card">
                        <div class="cash-label">Total Prizes</div>
                        <div class="cash-amount amount-negative" id="ptTotalPrizes">$0.00</div>
                    </div>
                    <div class="cash-card">
                        <div class="cash-label">Total Net</div>
                        <div class="cash-amount amount-positive" id="ptTotalNet">$0.00</div>
                    </div>
                    <div class="cash-card">
                        <div class="cash-label">Total Cash In</div>
                        <div class="cash-amount amount-positive" id="ptTotalCash">$0.00</div>
                    </div>
                </div>
                
                <div class="btn-group">
                    <button class="btn btn-primary" onclick="savePullTabs()">
                        <i class="material-icons">save</i> Save All Pull-Tabs
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Cash Close Section -->
        <div class="content-section" id="cashCloseSection">
            <div class="form-card">
                <div class="form-header">Session Cash Reconciliation</div>
                
                <!-- Income Summary -->
                <div class="form-section-title">Income Summary</div>
                <div class="cash-summary">
                    <div class="cash-card">
                        <div class="cash-label">Starting Cash</div>
                        <div class="cash-amount amount-neutral" id="closeStartCash">$0.00</div>
                    </div>
                    <div class="cash-card">
                        <div class="cash-label">Bingo Sales</div>
                        <div class="cash-amount amount-positive" id="closeBingoSales">$0.00</div>
                    </div>
                    <div class="cash-card">
                        <div class="cash-label">Pull-Tab Sales</div>
                        <div class="cash-amount amount-positive" id="closePTSales">$0.00</div>
                    </div>
                    <div class="cash-card">
                        <div class="cash-label">Gross Receipts</div>
                        <div class="cash-amount amount-positive" id="closeGross">$0.00</div>
                    </div>
                </div>
                
                <!-- Prizes Summary -->
                <div class="form-section-title">Prizes Paid</div>
                <div class="cash-summary">
                    <div class="cash-card">
                        <div class="cash-label">Bingo Prizes</div>
                        <div class="cash-amount amount-negative" id="closeBingoPrizes">$0.00</div>
                    </div>
                    <div class="cash-card">
                        <div class="cash-label">Pull-Tab Prizes</div>
                        <div class="cash-amount amount-negative" id="closePTPrizes">$0.00</div>
                    </div>
                    <div class="cash-card">
                        <div class="cash-label">Total Prizes</div>
                        <div class="cash-amount amount-negative" id="closeTotalPrizes">$0.00</div>
                    </div>
                    <div class="cash-card">
                        <div class="cash-label">Net Receipts</div>
                        <div class="cash-amount amount-positive" id="closeNet">$0.00</div>
                    </div>
                </div>
                
                <!-- Deposit & Offage -->
                <div class="form-section-title">Deposit & Offage Analysis</div>
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Actual Deposit Amount</label>
                        <input type="number" class="form-input" id="actualDeposit" placeholder="0.00" step="0.01" onchange="calculateOffage()">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Expected Deposit</label>
                        <input type="number" class="form-input" id="expectedDeposit" placeholder="0.00" readonly>
                    </div>
                </div>
                
                <div class="cash-summary">
                    <div class="cash-card">
                        <div class="cash-label">Bingo Offage</div>
                        <div class="cash-amount" id="bingoOffage">$0.00</div>
                    </div>
                    <div class="cash-card">
                        <div class="cash-label">Pull-Tab Offage</div>
                        <div class="cash-amount" id="ptOffage">$0.00</div>
                    </div>
                    <div class="cash-card">
                        <div class="cash-label">Combined Offage</div>
                        <div class="cash-amount" id="totalOffage">$0.00</div>
                    </div>
                    <div class="cash-card">
                        <div class="cash-label">Status</div>
                        <div class="cash-amount" id="offageStatus">BALANCED</div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Offage Comments/Explanation</label>
                    <textarea class="form-textarea" id="offageComments" rows="3" placeholder="Explain any variances..."></textarea>
                </div>
                
                <div class="btn-group">
                    <button class="btn btn-success" onclick="completeReconciliation()">
                        <i class="material-icons">check_circle</i> Complete Reconciliation
                    </button>
                    <button class="btn btn-primary" onclick="printReconciliation()">
                        <i class="material-icons">print</i> Print Report
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Reports Section -->
        <div class="content-section" id="reportsSection">
            <div class="form-card">
                <div class="form-header">Generate Reports</div>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Report Type</label>
                        <select class="form-select" id="reportType">
                            <option value="occasion">MGC Occasion Report</option>
                            <option value="quarterly">MGC Quarterly Report</option>
                            <option value="monthly">Monthly Board Report</option>
                            <option value="pulltab">Pull-Tab Analysis</option>
                            <option value="cash">Cash Analysis</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Quarter</label>
                        <select class="form-select" id="reportQuarter">
                            <option value="1">Q1 (Jan-Mar)</option>
                            <option value="2">Q2 (Apr-Jun)</option>
                            <option value="3">Q3 (Jul-Sep)</option>
                            <option value="4">Q4 (Oct-Dec)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Year</label>
                        <select class="form-select" id="reportYear">
                            <option value="2025">2025</option>
                            <option value="2024">2024</option>
                            <option value="2023">2023</option>
                        </select>
                    </div>
                </div>
                
                <div class="btn-group">
                    <button class="btn btn-primary" onclick="generateReport()">
                        <i class="material-icons">assessment</i> Generate
                    </button>
                    <button class="btn btn-success" onclick="exportReport()">
                        <i class="material-icons">download</i> Export PDF
                    </button>
                </div>
            </div>
            
            <div class="form-card" id="reportPreview" style="display: none;">
                <div class="form-header">Report Preview</div>
                <div id="reportContent"></div>
            </div>
        </div>
    </div>
    
    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>
    
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="spinner"></div>
            <p>Processing...</p>
        </div>
    </div>
    
    <!-- JavaScript -->
    <script>
        // Configuration
        const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbyAo1IsuFempsKZ3pE9fbxFImbFI-Ff2fpn6DJZEhlLXpkFrQJo6cdvyoOj4T1QkHmskg/exec';
        
        // Session Data
        let currentSession = {
            id: null,
            data: {},
            pullTabs: []
        };
        
        // Initialize
        document.addEventListener('DOMContentLoaded', init);
        
        function init() {
            document.getElementById('currentDate').textContent = new Date().toLocaleDateString();
            document.getElementById('occasionDate').valueAsDate = new Date();
            loadDashboard();
            loadPullTabGames();
            setDayOfWeek();
        }
        
        function setDayOfWeek() {
            const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
            const today = new Date();
            document.getElementById('dayOfWeek').value = days[today.getDay()];
        }
        
        // Navigation
        function switchTab(tabName) {
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(tabName + 'Section').classList.add('active');
            event.target.closest('.nav-tab').classList.add('active');
            
            if (tabName === 'cashClose') {
                loadReconciliation();
            }
        }
        
        // API Calls
        async function apiCall(action, data) {
            showLoading();
            try {
                const response = await fetch(WEB_APP_URL, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({action, ...data})
                });
                
                const result = await response.json();
                if (result.error) throw new Error(result.error);
                return result;
            } catch (error) {
                showToast('Error: ' + error.message, 'error');
                throw error;
            } finally {
                hideLoading();
            }
        }
        
        // Dashboard Functions
        async function loadDashboard() {
            try {
                const data = await apiCall('getDashboard', {});
                document.getElementById('sessionsCount').textContent = data.sessions || 0;
                document.getElementById('playersCount').textContent = data.players || 0;
                document.getElementById('grossReceipts').textContent = '$' + (data.gross || 0).toFixed(2);
                document.getElementById('netProfit').textContent = '$' + (data.net || 0).toFixed(2);
                
                loadRecentActivity();
            } catch (error) {
                console.error('Dashboard load error:', error);
            }
        }
        
        async function loadRecentActivity() {
            try {
                const data = await apiCall('getRecentActivity', {});
                const tbody = document.getElementById('activityBody');
                
                if (data.activity && data.activity.length > 0) {
                    tbody.innerHTML = data.activity.map(row => `
                        <tr>
                            <td>${new Date(row.date).toLocaleString()}</td>
                            <td>${row.session}</td>
                            <td>${row.type}</td>
                            <td>$${row.amount.toFixed(2)}</td>
                            <td><span class="status-indicator status-${row.status}">${row.status}</span></td>
                        </tr>
                    `).join('');
                } else {
                    tbody.innerHTML = '<tr><td colspan="5" style="text-align: center;">No recent activity</td></tr>';
                }
            } catch (error) {
                console.error('Activity load error:', error);
            }
        }
        
        // Bingo Occasion Functions
        function calcSale(input, price, targetId) {
            const quantity = parseInt(input.value) || 0;
            const sales = quantity * price;
            document.getElementById(targetId).value = sales.toFixed(2);
            updateTotals();
        }
        
        function updateTotals() {
            let paperTotal = 0;
            const paperFields = ['sixFaceSales', 'nineSolidSales', 'nineStripeSales', 
                               'coverallExtraSales', 'earlyBirdSales', 'letterXSales', 
                               'number7Sales', 'prog18Sales', 'prog3Sales'];
            
            paperFields.forEach(id => {
                paperTotal += parseFloat(document.getElementById(id).value) || 0;
            });
            
            const dauberSales = parseFloat(document.getElementById('dauberSales').value) || 0;
            const miscSales = parseFloat(document.getElementById('miscSales').value) || 0;
            const electronicTotal = parseFloat(document.getElementById('electronicTotal').value) || 0;
            
            const miscTotal = dauberSales + miscSales;
            const bingoGross = paperTotal + electronicTotal + miscTotal;
            
            document.getElementById('paperTotal').textContent = '$' + paperTotal.toFixed(2);
            document.getElementById('electronicDisplay').textContent = '$' + electronicTotal.toFixed(2);
            document.getElementById('miscDisplay').textContent = '$' + miscTotal.toFixed(2);
            document.getElementById('bingoGross').textContent = '$' + bingoGross.toFixed(2);
        }
        
        function updateBingoPrizes() {
            let total = 0;
            
            // Progressive prizes
            total += parseFloat(document.getElementById('prog1ActualPrize').value) || 0;
            total += parseFloat(document.getElementById('prog2ActualPrize').value) || 0;
            
            // Special games
            total += parseFloat(document.getElementById('letterXPrize').value) || 0;
            total += parseFloat(document.getElementById('number7Prize').value) || 0;
            total += parseFloat(document.getElementById('coverallPrize').value) || 0;
            
            // Regular and early bird
            total += parseFloat(document.getElementById('regularPrizes').value) || 0;
            total += parseFloat(document.getElementById('earlyBirdPrizes').value) || 0;
            
            document.getElementById('totalBingoPrizes').value = total.toFixed(2);
        }
        
        async function saveBingoOccasion() {
            try {
                const data = {
                    date: document.getElementById('occasionDate').value,
                    day: document.getElementById('dayOfWeek').value,
                    sessionNumber: document.getElementById('sessionNum').value,
                    closetWorker: document.getElementById('closetWorker').value,
                    lionInCharge: document.getElementById('lionInCharge').value,
                    totalPlayers: parseInt(document.getElementById('totalPlayers').value) || 0,
                    startingCash: parseFloat(document.getElementById('startingCash').value) || 0,
                    bingoGamesCount: parseInt(document.getElementById('bingoGamesCount').value) || 0,
                    
                    // Progressive Games
                    prog1Jackpot: parseFloat(document.getElementById('prog1Jackpot').value) || 0,
                    prog1BallsToWin: parseInt(document.getElementById('prog1BallsToWin').value) || 0,
                    prog1Consolation: parseFloat(document.getElementById('prog1Consolation').value) || 0,
                    prog1ActualPrize: parseFloat(document.getElementById('prog1ActualPrize').value) || 0,
                    prog1ActualBalls: parseInt(document.getElementById('prog1ActualBalls').value) || 0,
                    
                    prog2Jackpot: parseFloat(document.getElementById('prog2Jackpot').value) || 0,
                    prog2BallsToWin: parseInt(document.getElementById('prog2BallsToWin').value) || 0,
                    prog2Consolation: parseFloat(document.getElementById('prog2Consolation').value) || 0,
                    prog2ActualPrize: parseFloat(document.getElementById('prog2ActualPrize').value) || 0,
                    prog2ActualBalls: parseInt(document.getElementById('prog2ActualBalls').value) || 0,
                    
                    // Special Games
                    letterXPrize: parseFloat(document.getElementById('letterXPrize').value) || 0,
                    letterXBalls: parseInt(document.getElementById('letterXBalls').value) || 0,
                    number7Prize: parseFloat(document.getElementById('number7Prize').value) || 0,
                    number7Balls: parseInt(document.getElementById('number7Balls').value) || 0,
                    coverallPrize: parseFloat(document.getElementById('coverallPrize').value) || 0,
                    coverallBalls: parseInt(document.getElementById('coverallBalls').value) || 0,
                    
                    // Door Sales
                    doorSales: gatherDoorSalesData(),
                    
                    // Other Prizes
                    regularPrizes: parseFloat(document.getElementById('regularPrizes').value) || 0,
                    earlyBirdPrizes: parseFloat(document.getElementById('earlyBirdPrizes').value) || 0,
                    totalBingoPrizes: parseFloat(document.getElementById('totalBingoPrizes').value) || 0
                };
                
                const result = await apiCall('createBingoSession', data);
                if (result.success) {
                    currentSession.id = result.sessionId;
                    currentSession.data = data;
                    showToast('Bingo occasion saved successfully!', 'success');
                    document.getElementById('currentSession').textContent = 'Session: ' + result.sessionId;
                }
            } catch (error) {
                console.error('Save error:', error);
            }
        }
        
        function gatherDoorSalesData() {
            return {
                sixFaceNet: parseInt(document.getElementById('sixFaceNet').value) || 0,
                sixFaceSales: parseFloat(document.getElementById('sixFaceSales').value) || 0,
                nineSolidNet: parseInt(document.getElementById('nineSolidNet').value) || 0,
                nineSolidSales: parseFloat(document.getElementById('nineSolidSales').value) || 0,
                nineStripeNet: parseInt(document.getElementById('nineStripeNet').value) || 0,
                nineStripeSales: parseFloat(document.getElementById('nineStripeSales').value) || 0,
                birthdayBOGO: parseInt(document.getElementById('birthdayBOGO').value) || 0,
                coverallExtraNet: parseInt(document.getElementById('coverallExtraNet').value) || 0,
                coverallExtraSales: parseFloat(document.getElementById('coverallExtraSales').value) || 0,
                earlyBirdNet: parseInt(document.getElementById('earlyBirdNet').value) || 0,
                earlyBirdSales: parseFloat(document.getElementById('earlyBirdSales').value) || 0,
                letterXNet: parseInt(document.getElementById('letterXNet').value) || 0,
                letterXSales: parseFloat(document.getElementById('letterXSales').value) || 0,
                number7Net: parseInt(document.getElementById('number7Net').value) || 0,
                number7Sales: parseFloat(document.getElementById('number7Sales').value) || 0,
                prog18Net: parseInt(document.getElementById('prog18Net').value) || 0,
                prog18Sales: parseFloat(document.getElementById('prog18Sales').value) || 0,
                prog3Net: parseInt(document.getElementById('prog3Net').value) || 0,
                prog3Sales: parseFloat(document.getElementById('prog3Sales').value) || 0,
                electronicTotal: parseFloat(document.getElementById('electronicTotal').value) || 0,
                dauberCount: parseInt(document.getElementById('dauberCount').value) || 0,
                dauberSales: parseFloat(document.getElementById('dauberSales').value) || 0,
                miscSales: parseFloat(document.getElementById('miscSales').value) || 0
            };
        }
        
        // Pull-Tab Functions
        async function loadPullTabGames() {
            try {
                const result = await apiCall('getActivePullTabGames', {});
                const select = document.getElementById('ptGameSelect');
                select.innerHTML = '<option value="">Choose a game...</option>';
                
                result.games.forEach(game => {
                    const option = document.createElement('option');
                    option.value = JSON.stringify(game);
                    option.textContent = `${game.gameName} (${game.formNumber})`;
                    select.appendChild(option);
                });
            } catch (error) {
                console.error('Load PT games error:', error);
            }
        }
        
        function loadPTGame() {
            const select = document.getElementById('ptGameSelect');
            if (select.value) {
                const game = JSON.parse(select.value);
                document.getElementById('ptStarting').value = game.ticketCount;
                document.getElementById('ptPrice').value = game.pricePerTicket;
                document.getElementById('ptIdeal').value = game.idealProfit;
                calcPT();
            }
        }
        
        function calcPT() {
            const starting = parseInt(document.getElementById('ptStarting').value) || 0;
            const ending = parseInt(document.getElementById('ptEnding').value) || 0;
            const price = parseFloat(document.getElementById('ptPrice').value) || 0;
            const prizes = parseFloat(document.getElementById('ptPrizes').value) || 0;
            
            const sold = starting - ending;
            const gross = sold * price;
            const net = gross - prizes;
            
            document.getElementById('ptSold').value = sold;
            document.getElementById('ptGross').value = gross.toFixed(2);
            document.getElementById('ptNet').value = net.toFixed(2);
            
            calcPTVariance();
        }
        
        function calcPTVariance() {
            const net = parseFloat(document.getElementById('ptNet').value) || 0;
            const cashIn = parseFloat(document.getElementById('ptCashIn').value) || 0;
            const variance = cashIn - net;
            
            document.getElementById('ptVariance').value = variance.toFixed(2);
        }
        
        function addPullTab() {
            const gameSelect = document.getElementById('ptGameSelect');
            if (!gameSelect.value) {
                showToast('Please select a game', 'warning');
                return;
            }
            
            const game = JSON.parse(gameSelect.value);
            const ptData = {
                gameName: game.gameName,
                formNumber: game.formNumber,
                serial: document.getElementById('ptSerial').value,
                starting: parseInt(document.getElementById('ptStarting').value),
                ending: parseInt(document.getElementById('ptEnding').value),
                sold: parseInt(document.getElementById('ptSold').value),
                price: parseFloat(document.getElementById('ptPrice').value),
                gross: parseFloat(document.getElementById('ptGross').value),
                prizes: parseFloat(document.getElementById('ptPrizes').value),
                net: parseFloat(document.getElementById('ptNet').value),
                ideal: parseFloat(document.getElementById('ptIdeal').value),
                cashIn: parseFloat(document.getElementById('ptCashIn').value),
                variance: parseFloat(document.getElementById('ptVariance').value)
            };
            
            currentSession.pullTabs.push(ptData);
            updatePTTable();
            clearPTForm();
            showToast('Pull-tab game added!', 'success');
        }
        
        function updatePTTable() {
            const tbody = document.getElementById('ptTableBody');
            
            if (currentSession.pullTabs.length === 0) {
                tbody.innerHTML = '<tr><td colspan="9" style="text-align: center;">No pull-tabs recorded yet</td></tr>';
                return;
            }
            
            let totalGross = 0, totalPrizes = 0, totalNet = 0, totalCash = 0;
            
            tbody.innerHTML = currentSession.pullTabs.map((pt, index) => {
                totalGross += pt.gross;
                totalPrizes += pt.prizes;
                totalNet += pt.net;
                totalCash += pt.cashIn;
                
                return `
                    <tr>
                        <td>${pt.gameName}</td>
                        <td>${pt.serial}</td>
                        <td>${pt.sold}</td>
                        <td>$${pt.gross.toFixed(2)}</td>
                        <td>$${pt.prizes.toFixed(2)}</td>
                        <td>$${pt.net.toFixed(2)}</td>
                        <td>$${pt.cashIn.toFixed(2)}</td>
                        <td>$${pt.variance.toFixed(2)}</td>
                        <td><button class="btn btn-danger" onclick="removePT(${index})">Remove</button></td>
                    </tr>
                `;
            }).join('');
            
            document.getElementById('ptTotalGross').textContent = '$' + totalGross.toFixed(2);
            document.getElementById('ptTotalPrizes').textContent = '$' + totalPrizes.toFixed(2);
            document.getElementById('ptTotalNet').textContent = '$' + totalNet.toFixed(2);
            document.getElementById('ptTotalCash').textContent = '$' + totalCash.toFixed(2);
        }
        
        function removePT(index) {
            currentSession.pullTabs.splice(index, 1);
            updatePTTable();
        }
        
        function clearPTForm() {
            document.getElementById('ptGameSelect').selectedIndex = 0;
            document.getElementById('ptSerial').value = '';
            document.getElementById('ptStarting').value = '';
            document.getElementById('ptEnding').value = '';
            document.getElementById('ptSold').value = '';
            document.getElementById('ptPrice').value = '';
            document.getElementById('ptGross').value = '';
            document.getElementById('ptPrizes').value = '';
            document.getElementById('ptNet').value = '';
            document.getElementById('ptIdeal').value = '';
            document.getElementById('ptCashIn').value = '';
            document.getElementById('ptVariance').value = '';
        }
        
        async function savePullTabs() {
            if (currentSession.pullTabs.length === 0) {
                showToast('No pull-tabs to save', 'warning');
                return;
            }
            
            try {
                const result = await apiCall('savePullTabs', {
                    sessionId: currentSession.id,
                    pullTabs: currentSession.pullTabs
                });
                
                if (result.success) {
                    showToast('Pull-tabs saved successfully!', 'success');
                }
            } catch (error) {
                console.error('Save PT error:', error);
            }
        }
        
        // Cash Reconciliation Functions
        async function loadReconciliation() {
            if (!currentSession.id) {
                showToast('No active session', 'warning');
                return;
            }
            
            try {
                const result = await apiCall('getSessionSummary', {sessionId: currentSession.id});
                
                document.getElementById('closeStartCash').textContent = '$' + (result.startingCash || 0).toFixed(2);
                document.getElementById('closeBingoSales').textContent = '$' + (result.bingoSales || 0).toFixed(2);
                document.getElementById('closePTSales').textContent = '$' + (result.pullTabSales || 0).toFixed(2);
                document.getElementById('closeGross').textContent = '$' + (result.grossReceipts || 0).toFixed(2);
                document.getElementById('closeBingoPrizes').textContent = '$' + (result.bingoPrizes || 0).toFixed(2);
                document.getElementById('closePTPrizes').textContent = '$' + (result.pullTabPrizes || 0).toFixed(2);
                document.getElementById('closeTotalPrizes').textContent = '$' + (result.totalPrizes || 0).toFixed(2);
                document.getElementById('closeNet').textContent = '$' + (result.netReceipts || 0).toFixed(2);
                document.getElementById('expectedDeposit').value = (result.netReceipts || 0).toFixed(2);
                
            } catch (error) {
                console.error('Load reconciliation error:', error);
            }
        }
        
        function calculateOffage() {
            const expected = parseFloat(document.getElementById('expectedDeposit').value) || 0;
            const actual = parseFloat(document.getElementById('actualDeposit').value) || 0;
            const variance = actual - expected;
            
            // Simple offage calculation - would be more complex in production
            const bingoOffage = variance * 0.6; // 60% attributed to bingo
            const ptOffage = variance * 0.4; // 40% attributed to pull-tabs
            
            updateOffageDisplay('bingoOffage', bingoOffage);
            updateOffageDisplay('ptOffage', ptOffage);
            updateOffageDisplay('totalOffage', variance);
            
            const status = Math.abs(variance) < 5 ? 'BALANCED' : 
                          variance > 0 ? 'OVER' : 'SHORT';
            
            const statusEl = document.getElementById('offageStatus');
            statusEl.textContent = status;
            statusEl.className = status === 'BALANCED' ? 'cash-amount amount-positive' :
                                status === 'OVER' ? 'cash-amount amount-warning' :
                                'cash-amount amount-negative';
        }
        
        function updateOffageDisplay(elementId, amount) {
            const element = document.getElementById(elementId);
            element.textContent = '$' + Math.abs(amount).toFixed(2);
            element.className = Math.abs(amount) < 5 ? 'cash-amount amount-neutral' :
                               amount > 0 ? 'cash-amount amount-positive' :
                               'cash-amount amount-negative';
        }
        
        async function completeReconciliation() {
            try {
                const data = {
                    sessionId: currentSession.id,
                    actualDeposit: parseFloat(document.getElementById('actualDeposit').value) || 0,
                    offageComments: document.getElementById('offageComments').value
                };
                
                const result = await apiCall('completeReconciliation', data);
                
                if (result.success) {
                    showToast('Reconciliation completed!', 'success');
                    if (result.status === 'BALANCED') {
                        showToast('Session balanced!', 'success');
                    } else {
                        showToast(`Session ${result.status}: $${Math.abs(result.variance).toFixed(2)}`, 'warning');
                    }
                }
            } catch (error) {
                console.error('Complete reconciliation error:', error);
            }
        }
        
        // Report Functions
        async function generateReport() {
            const type = document.getElementById('reportType').value;
            const quarter = document.getElementById('reportQuarter').value;
            const year = document.getElementById('reportYear').value;
            
            try {
                const result = await apiCall('generateReport', {type, quarter, year});
                
                if (result.success) {
                    document.getElementById('reportContent').innerHTML = result.html;
                    document.getElementById('reportPreview').style.display = 'block';
                    showToast('Report generated!', 'success');
                }
            } catch (error) {
                console.error('Generate report error:', error);
            }
        }
        
        function exportReport() {
            window.print();
        }
        
        // Utility Functions
        function showToast(message, type = 'info') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            
            const icon = type === 'success' ? 'check_circle' :
                        type === 'error' ? 'error' :
                        type === 'warning' ? 'warning' : 'info';
            
            toast.innerHTML = `
                <i class="material-icons">${icon}</i>
                <span>${message}</span>
            `;
            
            container.appendChild(toast);
            
            setTimeout(() => toast.remove(), 5000);
        }
        
        function showLoading() {
            document.getElementById('loadingOverlay').style.display = 'flex';
        }
        
        function hideLoading() {
            document.getElementById('loadingOverlay').style.display = 'none';
        }
        
        function clearBingoForm() {
            document.querySelectorAll('#bingoOccasionSection input, #bingoOccasionSection select').forEach(field => {
                if (field.type !== 'button' && !field.readOnly) {
                    field.value = '';
                }
            });
            updateTotals();
            updateBingoPrizes();
        }
        
        function startNewOccasion() {
            currentSession = {id: null, data: {}, pullTabs: []};
            clearBingoForm();
            switchTab('bingoOccasion');
        }
        
        function printReconciliation() {
            window.print();
        }
    </script>
</body>
</html>
